webpackJsonp([3],{102:function(t,e,i){i(136);var a=i(1)(i(118),i(151),null,null);t.exports=a.exports},107:function(t,e,i){"use strict";var a=i(12),o=i.n(a);i.d(e,"a",function(){return r});var s=new o.a.Renderer,n=[];s.heading=function(t,e){var i=t.toLowerCase().replace(/\s+/g,"-");return n.push({level:e,slug:i,title:t}),"<h"+e+"><a href='#"+i+"' id='"+i+"' class='anchor'></a><a href='#"+i+"'>"+t+"</a></h"+e+">"};var r=function(t){var e=o.a.lexer(t);return t=o.a.parser(e).replace(/<pre>/gi,'<pre class="hljs">')}},118:function(t,e,i){"use strict";function a(t){var e=t.state.route.params.path;return e?Promise.all([t.dispatch("fetch_topic",{path:e,query:{origin:!0}}),t.dispatch("fetch_categories"),t.dispatch("fetch_tags")]):Promise.all([t.dispatch("fetch_categories"),t.dispatch("fetch_tags")])}Object.defineProperty(e,"__esModule",{value:!0});var o=i(4),s=(i.n(o),i(107)),n=i(20),r=(i.n(n),Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t});e.default={data:function(){return{title:"",path:"",thumbnail:"",dyn_thumbnail:"",content:"",type:"md",toc:"",top:!1,allowComment:!0,hidden:!1,category:"",selectedTags:[],enableToc:!0,mode:1,imgFiles:[],imgsBase64:[],imgsUrl:[],uploadQueue:[],foldUpload:!1}},watch:{thumbnail:function(){this.dyn_thumbnail=this.thumbnail},"$route.params.path":function(){this.title="",this.path="",this.thumbnail="",this.category="",this.selectedTags=[],this.content="",this.toc="",this.top=!1,this.allowComment=!0,this.hidden=!1,this.enableToc=!0,this.mode=1}},computed:r({preview_content:function(){return i.i(s.a)(this.content)},categories:function(){return this.$store.getters.category_list},tags:function(){return this.$store.getters.tag_list},authorId:function(){return this.$store.getters.login_user._id},topicPath:function(){return this.$route.params.path}},i.i(o.mapGetters)(["topic_curr","login_user"])),methods:{onFile:function(t){var e=this,a=t.target.files,o=a.length-1,s=a[o],r=(new Date).toISOString().substr(0,10).replace("-","")+"/"+s.name;this.uploadQueue.push(1);var c=void 0;i.i(n.fileReader)(s).then(function(t){return e.imgsBase64.push(t.result),e.$store.dispatch("cdn_token",r)}).then(function(t){if(!(t.code>200))return c={file:s,name:r,token:t.data.token,key:t.data.key,host:t.data.host},e.imgFiles.push(c),c}).then(function(t){return e.$store.dispatch("cdn_img_upload",{key:t.key,file:t.file,token:t.token})}).then(function(t){if(t.key){var a=e.imgFiles[0].host+t.key;e.imgsUrl.push(a),e.uploadQueue.pop(),e.content+='<p class="center"><img src="'+a+'"></p>';var o=e.$refs.preview;e.$nextTick(function(){i.i(n.smoothScroll)(0,o.scrollHeight,o)})}}).catch(function(t){console.error(t)})},upload:function(){this.$refs.file.click()},setThumbnail:function(t){this.thumbnail=this.thumbnail===this.imgsUrl[t]?"":this.imgsUrl[t]},removeImage:function(t){this.imgsBase64.splice(t,1)},switchCategory:function(t){this.category=t},addTag:function(t){var e=this.selectedTags.indexOf(t);e>-1?this.selectedTags.splice(e,1):this.selectedTags.push(t)},save:function(){var t=void 0;t=this.topic_curr._id?"edit_topic_"+this.topic_curr._id:"new_topic",localStorage[t]=JSON.stringify({title:this.title,path:this.path,mode:this.mode,content:this.content,thumbnail:this.thumbnail,category:this.category,selectedTags:this.selectedTags,top:this.top,enableToc:this.enableToc,allowComment:this.allowComment,hidden:this.hidden})},publish:function(){var t={title:this.title,path:this.path,authorId:this.authorId,content:this.content,thumbnail:this.thumbnail,category:this.category,tags:this.selectedTags,top:this.top,allowComment:this.allowComment,hidden:this.hidden};if(this.enableToc&&(t.toc=this.toc),this.topicPath){var e=this.topic_curr._id;return this.$store.dispatch("update_topic",{id:e,body:t}).then(this.published)}return this.$store.dispatch("create_topic",t).then(this.published)},published:function(t){return t.code>200?this.$store.dispatch("logger",t):(this.topic_curr._id?localStorage.removeItem("edit_topic_"+this.topic_curr._id):localStorage.removeItem("new_topic"),this.$store.dispatch("logger",t),void this.$router.push("/topic/"+this.path))},openDialog:function(t){this.$store.dispatch("dialog",t)},loadTopicFields:function(t){this.title=t.title,this.path=t.path,this.thumbnail=t.thumbnail,this.mode=t.mode||1,this.content=t.content,this.category=t.category,this.selectedTags=t.selectedTags||t.tags,this.top=t.top,this.enableToc=t.enableToc,this.hidden=t.hidden},loadExistingTopicFields:function(t){var e=t.getters.topic_curr,i=void 0;if(i=e._id?localStorage["edit_topic_"+e._id]:localStorage.new_topic)try{this.loadTopicFields(JSON.parse(i))}catch(t){console.log(t),this.loadTopicFields(e)}else this.loadTopicFields(e)}},beforeMount:function(){var t=this,e=this.$route.params.path;a(this.$store).then(function(){e&&t.loadExistingTopicFields(t.$store)})}}},126:function(t,e,i){e=t.exports=i(100)(),e.push([t.i,".view-edit-topic .wide-screen{height:100%}.view-edit-topic .navigator{height:35px;line-height:35px;font-size:.9em;background-color:#f6f6f6;border-radius:4px 4px 0 0}.view-edit-topic main{margin-right:305px}.view-edit-topic main .btn{padding:3px 12px}.view-edit-topic main header{position:relative;padding-top:10px}.view-edit-topic main header .title{line-height:1.5em;font-size:1.3em;font-weight:700}.view-edit-topic main header .subtitle{line-height:1.1em;color:#2c2c30}.view-edit-topic main header .mode{height:40px;line-height:40px}.view-edit-topic main header .mode .btn.right{margin-right:10px}.view-edit-topic main header .mode .btn-switch{font-weight:700;margin-left:-1px}.view-edit-topic main .edit-area{position:relative;padding:15px 10px;height:700px}.view-edit-topic main .edit-area .note{text-align:right;width:120px 9;margin-left:10px}.view-edit-topic main .edit-area.mode-0 .text{width:100%;border-right:none}.view-edit-topic main .edit-area.mode-0 .preview{display:none}.view-edit-topic main .edit-area.mode-1 .preview,.view-edit-topic main .edit-area.mode-1 .text{width:50%}.view-edit-topic main .edit-area.mode-1 .text{border-right:1px solid #e2e2e2}.view-edit-topic main .edit-area.mode-2 .text{display:none}.view-edit-topic main .edit-area.mode-2 .preview{width:100%}.view-edit-topic main .edit-area .preview,.view-edit-topic main .edit-area .text{float:left;height:100%;padding:5px;overflow:auto;border-top:1px solid #e2e2e2;border-bottom:1px solid #e2e2e2}.view-edit-topic main .edit-area .text{border-left:none}.view-edit-topic main .edit-area .preview{float:left;margin-left:-1px}.view-edit-topic aside{width:295px;min-height:700px;margin-bottom:20px}.view-edit-topic aside .box{padding:10px;border-bottom:1px solid #e2e2e2}.view-edit-topic aside .box .fa{color:#ff9530}.view-edit-topic aside .box .fa.fa-check-circle{color:#4cd964}.view-edit-topic aside .btn-group .btn{padding:5px 12px}.view-edit-topic aside .categories,.view-edit-topic aside .tags{margin-top:10px}.view-edit-topic aside .category{margin:3px 6px 3px 0;padding:3px 6px;font-size:.9em}.view-edit-topic aside .tag{margin:2px 5px 2px 0;padding:2px 5px;font-size:.8em}.view-edit-topic aside .switches{font-size:.9em;line-height:1.5em}.view-edit-topic aside .images .btn-upload{margin:10px 10px 10px 0;padding:3px 6px;font-size:.8em}.view-edit-topic aside .images input[type=file]{display:none}.view-edit-topic aside .images .uploaded{padding-top:10px;border-bottom:1px solid #e2e2e2;font-size:.8em}.view-edit-topic aside .images .uploaded .btn-group{width:100%;height:40px}.view-edit-topic aside .images .uploaded a{display:block}.view-edit-topic aside .images .uploaded img{min-width:40px;max-width:70%}.view-edit-topic aside .images .uploaded span{padding:3px 6px}",""])},136:function(t,e,i){var a=i(126);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i(101)("5406c216",a,!0)},151:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"view view-edit-topic"},[i("div",{staticClass:"full-screen row pad-lr-10"},[i("aside",{staticClass:"block right"},[i("nav",{staticClass:"navigator pad-lr-10"},[t._v("Operations")]),i("div",{staticClass:"box btn-group flex around_center"},[i("span",{staticClass:"btn btn-green",on:{click:t.save}},[i("b",[t._v("SAVE")])]),i("span",{staticClass:"btn btn-blue right",on:{click:t.publish}},[i("b",[t._v("PUBLISH")])])]),i("div",{staticClass:"box"},[i("b",[t._v("Choose a category")]),"editor"===t.login_user.role?i("i",{staticClass:"btn fa fa-plus hover_rotate_90 right",on:{click:function(e){t.openDialog("add_category")}}}):t._e(),i("div",{staticClass:"categories"},t._l(t.categories,function(e){return i("span",{staticClass:"category btn rad-4",class:t.category===e._id?"btn-green":"btn-green-h-b",on:{click:function(i){t.switchCategory(e._id)}}},[t._v("\n\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t")])}))]),i("div",{staticClass:"box"},[i("b",[t._v("Select tags")]),"editor"===t.login_user.role?i("i",{staticClass:"btn fa fa-plus right hover_rotate_90",on:{click:function(e){t.openDialog("add_tag")}}}):t._e(),i("div",{staticClass:"tags"},t._l(t.tags,function(e){return i("span",{staticClass:"tag btn rad-4",class:t.selectedTags.indexOf(e._id)>-1?"btn-blue":"btn-blue-h-b",on:{click:function(i){t.addTag(e._id)}}},[t._v("\n\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t")])}))]),i("div",{staticClass:"box switches row"},[i("label",{attrs:{for:"push_top"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.top,expression:"top"}],attrs:{type:"checkbox",id:"push_top"},domProps:{checked:Array.isArray(t.top)?t._i(t.top,null)>-1:t.top},on:{click:function(e){var i=t.top,a=e.target,o=!!a.checked;if(Array.isArray(i)){var s=null,n=t._i(i,s);o?n<0&&(t.top=i.concat(s)):n>-1&&(t.top=i.slice(0,n).concat(i.slice(n+1)))}else t.top=o}}}),t._v(" Push to top\n\t\t\t\t")]),i("br"),i("label",{attrs:{for:"enable_toc"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.enableToc,expression:"enableToc"}],attrs:{type:"checkbox",id:"enable_toc"},domProps:{checked:Array.isArray(t.enableToc)?t._i(t.enableToc,null)>-1:t.enableToc},on:{click:function(e){var i=t.enableToc,a=e.target,o=!!a.checked;if(Array.isArray(i)){var s=null,n=t._i(i,s);o?n<0&&(t.enableToc=i.concat(s)):n>-1&&(t.enableToc=i.slice(0,n).concat(i.slice(n+1)))}else t.enableToc=o}}}),t._v(" Enable TOC\n\t\t\t\t")]),i("br"),i("label",{attrs:{for:"allow_comment"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.allowComment,expression:"allowComment"}],attrs:{type:"checkbox",id:"allow_comment"},domProps:{checked:Array.isArray(t.allowComment)?t._i(t.allowComment,null)>-1:t.allowComment},on:{click:function(e){var i=t.allowComment,a=e.target,o=!!a.checked;if(Array.isArray(i)){var s=null,n=t._i(i,s);o?n<0&&(t.allowComment=i.concat(s)):n>-1&&(t.allowComment=i.slice(0,n).concat(i.slice(n+1)))}else t.allowComment=o}}}),t._v(" Allow comment\n\t\t\t\t")]),i("br"),i("label",{attrs:{for:"private_topic"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.hidden,expression:"hidden"}],attrs:{type:"checkbox",id:"private_topic"},domProps:{checked:Array.isArray(t.hidden)?t._i(t.hidden,null)>-1:t.hidden},on:{click:function(e){var i=t.hidden,a=e.target,o=!!a.checked;if(Array.isArray(i)){var s=null,n=t._i(i,s);o?n<0&&(t.hidden=i.concat(s)):n>-1&&(t.hidden=i.slice(0,n).concat(i.slice(n+1)))}else t.hidden=o}}}),t._v(" Private\n\t\t\t\t")]),i("br")]),i("div",{staticClass:"thumbnail box"},[i("b",[t._v("Current Thumbnail")]),i("br"),i("p",{staticClass:"center"},[i("a",{attrs:{href:t.dyn_thumbnail?t.dyn_thumbnail:"#",target:"_blank"}},[t.dyn_thumbnail?i("img",{staticClass:"rad-4",attrs:{width:"40%",src:t.dyn_thumbnail+"-tn.jpg"}}):t._e()])])]),i("div",{staticClass:"box images"},[i("b",[t._v("Upload Image")]),i("i",{staticClass:"fa right",class:t.foldUpload?"fa-caret-down":"fa-caret-up",on:{click:function(e){t.foldUpload=!t.foldUpload}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.foldUpload,expression:"!foldUpload"}]},[i("span",{staticClass:"btn btn-green btn-upload",on:{click:t.upload}},[t._v("UPLOAD")]),i("span",[t._v(t._s(0===t.uploadQueue.length?"Ready":"Uploading"))]),i("input",{ref:"file",attrs:{type:"file",name:"file",accept:"image/gif, image/png, image/jpeg, image/bmp, image/webp"},on:{change:t.onFile}}),t._l(t.imgsBase64,function(e,a){return i("div",{staticClass:"uploaded"},[i("a",{staticClass:"center",attrs:{href:e,target:"_blank"}},[i("img",{staticClass:"rad-4",attrs:{src:e,alt:e}}),i("br")]),i("div",{staticClass:"btn-group flex around_center"},[i("span",{directives:[{name:"show",rawName:"v-show",value:t.imgsUrl[a],expression:"imgsUrl[i]"}],staticClass:"btn",class:t.thumbnail===t.imgsUrl[a]?"btn-orange":"btn-orange-h-b",on:{click:function(e){t.setThumbnail(a)}}},[t._v("Thumbnail\n\t\t\t\t\t\t\t\t"),i("i",{directives:[{name:"show",rawName:"v-show",value:t.thumbnail===t.imgsUrl[a],expression:"thumbnail===imgsUrl[i]"}],staticClass:"fa fa-check-circle"})]),i("span",{staticClass:"btn btn-red",on:{click:function(e){t.removeImage(a)}}},[t._v("Remove")])])])})],2)])]),i("main",{staticClass:"main block"},[i("nav",{staticClass:"navigator pad-lr-10"},[i("router-link",{attrs:{to:"/"}},[t._v("Home")]),t._v(" / "+t._s(t.topicPath?"Edit":"Create")+" a topic\n\t\t\t")],1),i("div",{staticClass:"pad-lr-10"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"title",attrs:{type:"text",placeholder:"Title"},domProps:{value:t._s(t.title)},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model",value:t.path,expression:"path"}],staticClass:"subtitle",attrs:{type:"text",placeholder:"Path"},domProps:{value:t._s(t.path)},on:{input:function(e){e.target.composing||(t.path=e.target.value)}}}),i("div",{staticClass:"mode"},[i("span",{staticClass:"btn btn-switch",class:0==t.mode?"btn-blue":"btn-blue-h-b",on:{click:function(e){t.mode=0}}},[t._v("Write")]),i("span",{staticClass:"btn btn-switch",class:1==t.mode?"btn-blue":"btn-blue-h-b",on:{click:function(e){t.mode=1}}},[t._v("Split")]),i("span",{staticClass:"btn btn-switch",class:2==t.mode?"btn-blue":"btn-blue-h-b",on:{click:function(e){t.mode=2}}},[t._v("Preview")]),i("a",{staticClass:"btn btn-tealBlue-h-b right",attrs:{href:"http://markdown-guide.readthedocs.io/en/latest/basics.html#blockquotes",target:"_blank"}},[t._v("Syntax Guide")])])]),i("div",{staticClass:"row edit-area",class:"mode-"+t.mode},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"text box",domProps:{value:t._s(t.content)},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}}),i("div",{ref:"preview",staticClass:"preview box md-body",domProps:{innerHTML:t._s(t.preview_content)}})])]),i("footer",{staticClass:"bg-white rad-4"})])])},staticRenderFns:[]}}});